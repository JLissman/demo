<!DOCTYPE html>

<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
    <meta charset="UTF-8">
    <title>Competence Finder - Admintools</title>
    <script src="{{ url_for('static', filename='js/searchtags.js') }}" defer></script>


</head>
<frame>
    <div class="topmenu">
        <a href="/home">Home</a>
        <a href="search">All Consultants</a>
        <a href="advSearch">Advanced Search</a>
        <div id="userName">Logged in as:<br><img id="profile_image" width="50px" height="50px" src={{session['image']}}> {{session['name']}}</div>
        <a href="logout">Log out</a>
        {% if session["admin"] == 1 %}
        <a class="active" href="admin"> Admin Tools</a>
        {% endif %}
        <form id="searchForm" action="search" autocomplete="off">
        <input name="query" id="search" type="text" list="programmingLanguages" placeholder="Search">
            <datalist id="programmingLanguages">
                {{programmingLanguages|safe}}
                </datalist></form>

    </div>
    <div id="searchtags-container">

    </div>
{% if session["admin"] == 1 %}
    <div id="autoTools">
        <div id="workerstatus"><p>Auto Tools</p></div>
    {% if linked == 0 %}
        <form action="admin" method="post">
        <button name="action" value="linkedin">Start Linkedin Scraper</button>
        </form>
    {% else %}
        <button>Linkedin Scraper is running</button>
    {% endif %}

    {% if cvreader == 0 %}
        <form action="admin" method="post">
        <button name="action" value="cvreader">Start CV Reader</button>
        </form>
        <form action = "/admin/cv/upload" method = "POST"
         enctype = "multipart/form-data">
         <input type = "file" name = "file" accept=".docx, .pdf"/>
         <input type = "submit"/>
      </form>
    {% else %}
        <button>CvReader is running</button>
    {% endif %}


<label for="celeryStatus">Worker Status (long loading)</label>
    <iframe height="20%" id="celeryStatus" src="/admin/celeryStatus"></iframe>
    </div>
    <datalist id="tagList">
        {{programmingLanguages|safe}}
    </datalist>

    <label for="addNewConsult">Add new consult</label>
    <form id="addNewConsultForm" action="admin/consult/add" method="post" name="addNewConsult" enctype="multipart/form-data">
        <input class="addField" type="text" name="name" placeholder="Name">
        <input class="addField" type="text" name="role" placeholder="Role">
        <input class="addField" type="text" name="location" placeholder="Location">
        <input class="addField" type="file" name="profilePicture" accept=".jpg, .png">
        <input class="addField" type="text" name="description" placeholder="Description">
        <input id="addNewConsult-tags" class="addField" list="tagList" type="text" name="tags" placeholder="Tags">
        <div id="addTagsContainer"></div>
        <button id="submitNewConsult" type="submit">Add new consult</button>
    </form>
    <label for="removeConsult">Remove Consult</label>
    <form id="removeConsult" action="admin/consult/remove" method="post">

        <select id="removeConsultInput" list="consultList" type="text" name="id">
        <datalist id="consultList">
            {% for consult_id in consultantsOptions %}
            <option value="{{consult_id}}">{{consultantsOptions[consult_id]['name']}}, {{consultantsOptions[consult_id]['role']}}, {{consultantsOptions[consult_id]['location']}}</option>
            {% endfor %}
        </datalist>
        </select>
        <button type="submit">Remove consult</button>

    </form>
    <label for="tagChange">Add / remove Tag</label>
    <form id="tagChange">
        <select id="tagOption">
            <option name="removeTag">Remove Tag</option>
            <option name="Add tag">Add Tag</option>
        </select>
        <input text="text" name="tag" placeholder="Tagname">

    </form>

    <script>
    let addConsultTagList=[]
    eventTriggers = ["keyup","keydown"]
    let addNewConsultSubmitButton = document.getElementById('submitNewConsult')
   document.querySelectorAll('.addField').forEach(item => {
    eventTriggers.forEach(trigger => {
        item.addEventListener(trigger, event => {
            if(trigger == "keyup"){
                event.preventDefault()
                }
                else{
                if(event.key == "Enter"){
                    event.preventDefault()
                    if(item.getAttribute('name') == "tags"){
                        if(optionNames.includes(item.value.toLowerCase())){
                            addTag(item.value,'addTagsContainer')
                            item.value = ""
                            item.placeholder = "Add new tag"
                            }
                    else{
                        item.value = ""
                        item.placeholder = "Tag not found"
                        }
                    }
                }
            }
        })
        })
        })
    addNewConsultSubmitButton.addEventListener('click', (event)=>{
        console.log(event)
        event.preventDefault()
        inputfield = document.getElementById('addNewConsult-tags')
        addConsultTagList.forEach(e =>inputfield.value = inputfield.value + ", " + e )
        document.getElementById('addNewConsultForm').submit()
    })
    </script>
    {% endif %}



<footer>
    <div id="menu-outerFooter">
        <div class="table">
            <a href="mailto:jonathan.lissman.intern@purplescout.se">Support</a>
            <a href="https://www.purplescout.se">Contact</a>
        </div>
    </div>
</footer>
</body>


</html>